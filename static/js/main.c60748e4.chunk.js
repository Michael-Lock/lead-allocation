(this["webpackJsonplead-allocation"]=this["webpackJsonplead-allocation"]||[]).push([[0],{35:function(e,t,n){},38:function(e,t){},40:function(e,t){},55:function(e,t,n){"use strict";n.r(t);var r=n(2),o=n.n(r),a=n(22),i=n.n(a),c=(n(35),n(1)),l=n(6),s=n(23),u=n(24),d=n(30),h=n(29),p=n(25),v=n(0),f=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).handleOpenDialog=function(e){r.state.buttonRef.current&&r.state.buttonRef.current.open(e)},r.handleOnFileLoad=function(e){return r.props.onFileLoad(e)},r.handleOnError=function(e,t,n,r){console.log(e)},r.handleOnRemoveFile=function(e){return r.props.onFileRemove()},r.handleRemoveFile=function(e){r.state.buttonRef.current&&r.state.buttonRef.current.removeFile(e)},r.state={buttonRef:o.a.createRef()},r}return Object(u.a)(n,[{key:"render",value:function(){var e=this;return Object(v.jsx)(p.a,{ref:this.state.buttonRef?this.state.buttonRef:null,onFileLoad:this.handleOnFileLoad,onError:this.handleOnError,noClick:!0,noDrag:!0,config:{header:!0,dynamicTyping:!0,skipEmptyLines:!0},onRemoveFile:this.handleOnRemoveFile,children:function(t){var n=t.file;return Object(v.jsxs)("aside",{style:{display:"flex",flexDirection:"row",marginBottom:10},children:[Object(v.jsx)("button",{type:"button",onClick:e.handleOpenDialog,disabled:e.props.disabled,style:{borderRadius:0,marginLeft:0,marginRight:0,width:"40%",paddingLeft:0,paddingRight:0},children:"Browse file"}),Object(v.jsx)("div",{style:{borderWidth:1,borderStyle:"solid",borderColor:"#ccc",height:45,lineHeight:2.5,marginTop:5,marginBottom:5,paddingLeft:13,paddingTop:3,width:"60%"},children:n&&n.name}),Object(v.jsx)("button",{style:{borderRadius:0,marginLeft:0,marginRight:0,paddingLeft:20,paddingRight:20},onClick:e.handleRemoveFile,children:"Remove"})]})}})}}]),n}(r.Component),m={RoundRobin:{id:0,name:"Round Robin",description:"Allocates leads one by one to each available CA",allocationFunction:function(e,t){for(var n=e.slice(),r=t.map((function(e){var t=Object(c.a)({},e);return t.lastAllocatedId=-1,t})),o=r.filter((function(e){return e.portfolio===b})),a=r.filter((function(e){return e.portfolio===g})),i=function(e){var t=n[e],i=void 0;t.portfolio===b?i=o.sort((function(e,t){return e.lastAllocatedId-t.lastAllocatedId})):t.portfolio===g&&(i=a.sort((function(e,t){return e.lastAllocatedId-t.lastAllocatedId})));var c=i.filter((function(e){return A(t.created,e.location)})),l=c.length>0?c[0]:i[0];l.lastAllocatedId=t.leadId,t.allocatedCa=l.id,r[l.id].currentAllotment++},l=0;l<e.length;l++)i(l);return{leads:n,courseAdvisors:r}}},MostSuitableAggressive:{id:1,name:"Most Suitable (Aggressive)",description:"Allocates leads always to the CA with the highest likelihood of conversion. Uses lowest current allotment as a tiebreaker",allocationFunction:function(e,t){for(var n=e.slice(),r=t.slice(),o=function(e){for(var t=n[e],o=r.filter((function(e){return O(e,t)})),a=0;a<o.length;a++){var i=o[a],l=A(t.created,r[i.id].location);o[a]=Object(c.a)(Object(c.a)({},i),{},{propensity:t.courseAdvisors[i.id].propensity,isInWorkingHours:l})}o.sort((function(e,t){return t.isInWorkingHours&&!e.isInWorkingHours?1:e.isInWorkingHours&&!t.isInWorkingHours?-1:t.propensity!==e.propensity?t.propensity-e.propensity:e.currentAllotment-t.currentAllotment}));var s=o[0];t.allocatedCa=s.id,r[s.id].currentAllotment++},a=0;a<e.length;a++)o(a);return{leads:n,courseAdvisors:r}}},MostSuitableHardAllotmentTolerance:{id:2,name:"Most Suitable (Hard allotment tolerance)",description:"Allocates leads to the CA with the highest likelihood of conversion, so long as their allotment is not a given number of leads more than any other CA currently available",parameters:{allotmentTolerance:{order:0,label:"Allotment Tolerance"}},allocationFunction:function(e,t,n){for(var r=e.slice(),o=t.slice(),a=n.allotmentTolerance,i=function(e){for(var t=r[e],n=Number.MAX_SAFE_INTEGER,i=o.filter((function(e){return O(e,t)})),l=0;l<i.length;l++){var s=i[l];n=s.currentAllotment<n?s.currentAllotment:n;var u=A(t.created,o[s.id].location);i[l]=Object(c.a)(Object(c.a)({},s),{},{propensity:t.courseAdvisors[s.id].propensity,isInWorkingHours:u})}i.sort((function(e,t){return t.isInWorkingHours&&!e.isInWorkingHours?1:e.isInWorkingHours&&!t.isInWorkingHours?-1:t.currentAllotment-n<a&&e.currentAllotment-n>=a?1:e.currentAllotment-n<a&&t.currentAllotment-n>=a?-1:e.currentAllotment-n>=a&&t.currentAllotment-n>=a&&t.currentAllotment!==e.currentAllotment?e.currentAllotment-t.currentAllotment:t.propensity!==e.propensity?t.propensity-e.propensity:e.currentAllotment-t.currentAllotment}));var d=i[0];t.allocatedCa=d.id,o[d.id].currentAllotment++},l=0;l<e.length;l++)i(l);return{leads:r,courseAdvisors:o}}}},b="Domestic",g="Canada",j={Adelaide:{startHour:9,endHour:17},Canada:{startHour:22.5,endHour:6.5}};function O(e,t){return e.portfolio===t.portfolio}function A(e,t){var n=j[t],r=e.hour()+e.minute()/60,o=n.endHour,a=r;return n.endHour<=n.startHour&&(o=n.endHour+24,r<n.startHour&&(a+=24)),a>=n.startHour&&a<=o}var y=function(e){var t=[Object(v.jsx)("option",{value:null,hidden:!0},"unselected")];t=t.concat(Object.keys(m).map((function(e){return Object(v.jsx)("option",{value:e,children:m[e].name},m[e].name)})));var n=[];if(e.selectedMode&&e.selectedMode.parameters)for(var r=Object.keys(e.selectedMode.parameters),o=0;o<r.length;o++){var a=e.selectedMode.parameters[r[o]];n[o]=Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:r[o],children:a.label}),Object(v.jsx)("input",{name:r[o],type:"number",step:"any",onChange:e.onParameterChange})]},r[o])}return Object(v.jsxs)("div",{children:[Object(v.jsx)("select",{onChange:function(t){return e.onModeChange(t.target.value)},children:t}),Object(v.jsx)("div",{children:e.selectedMode?e.selectedMode.description:""}),n]})},x=n(27),I=n.n(x),C=n(28);function R(e){var t=e.columns,n=e.data,r=Object(C.useTable)({columns:t,data:n}),o=r.getTableProps,a=r.getTableBodyProps,i=r.headerGroups,l=r.rows,s=r.prepareRow;return Object(v.jsxs)("table",Object(c.a)(Object(c.a)({},o()),{},{children:[Object(v.jsx)("thead",{children:i.map((function(e){return Object(v.jsx)("tr",Object(c.a)(Object(c.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e){return Object(v.jsx)("th",Object(c.a)(Object(c.a)({},e.getHeaderProps()),{},{children:e.render("Header")}))}))}))}))}),Object(v.jsx)("tbody",Object(c.a)(Object(c.a)({},a()),{},{children:l.map((function(e,t){return s(e),Object(v.jsx)("tr",Object(c.a)(Object(c.a)({},e.getRowProps()),{},{children:e.cells.map((function(e){return Object(v.jsx)("td",Object(c.a)(Object(c.a)({},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}))]}))}var H=function(e){var t=o.a.useMemo((function(){return[{Header:"CA",accessor:"caName"},{Header:"Portfolio",accessor:"portfolio"},{Header:"Location",accessor:"location"},{Header:"Allotment",accessor:"currentAllotment"},{Header:"Average Propensity",accessor:function(e){return e?e.averagePropensity.toFixed(2):0}},{Header:"Variance to Inherent",accessor:function(e){return e?e.varianceToInherent.toFixed(2):0}},{Header:"Predicted Conversions",accessor:function(e){return e?e.predictedConversions.toFixed(2):0}}]}),[]),n=o.a.useMemo((function(){return[{Header:"Total Leads",accessor:"totalLeads"},{Header:"Average Propensity",accessor:function(e){return e?e.averagePropensity.toFixed(2):0}},{Header:"Average Variance to Inherent",accessor:function(e){return e?e.averageVarianceToInherent.toFixed(2):0}},{Header:"Predicted Conversions",accessor:function(e){return e?e.predictedConversions.toFixed(2):0}}]}),[]);return Object(v.jsxs)("div",{children:[Object(v.jsx)("h3",{children:"Aggregated Results"}),Object(v.jsx)(R,{columns:n,data:e.aggregatedResults?[e.aggregatedResults]:[]}),Object(v.jsx)("h3",{children:"Individual CA Results"}),Object(v.jsx)(R,{columns:t,data:e.courseAdvisors?e.courseAdvisors:[]})]})};var F=function(){var e=Object(r.useState)(),t=Object(l.a)(e,2),n=t[0],o=t[1],a=Object(r.useState)(),i=Object(l.a)(a,2),s=i[0],u=i[1],d=Object(r.useState)(),h=Object(l.a)(d,2),p=h[0],b=h[1],g=Object(r.useState)(),j=Object(l.a)(g,2),O=j[0],A=j[1],x=Object(r.useState)(),C=Object(l.a)(x,2),R=C[0],F=C[1],P=["leadId","created","inherent","portfolio"],k=function(){o(),u(),A(),F()},L=function(e){for(var t=e.courseAdvisors.slice(),n=0;n<e.leads.length;n++){var r=e.leads[n],o=t[r.allocatedCa],a=r.courseAdvisors[o.id].propensity;o.cumulativePropensity=o.cumulativePropensity+a,o.cumulativeInherent=o.cumulativeInherent+r.inherent}for(var i={totalLeads:0,cumulativePropensity:0,cumulativeInherent:0,averagePropensity:0,averageVarianceToInherent:0,predictedConversions:0},l=0;l<t.length;l++){var s=t[l];s.averagePropensity=s.currentAllotment?s.cumulativePropensity/s.currentAllotment:0,s.varianceToInherent=s.cumulativePropensity-s.cumulativeInherent,s.predictedConversions=s.currentAllotment*s.averagePropensity,i.totalLeads+=s.currentAllotment,i.cumulativePropensity+=s.cumulativePropensity,i.cumulativeInherent+=s.cumulativeInherent,i.predictedConversions+=s.predictedConversions}i.averagePropensity=i.cumulativePropensity/i.totalLeads,i.averageVarianceToInherent=(i.cumulativePropensity-i.cumulativeInherent)/t.length;var u=Object(c.a)({},e);return u.courseAdvisors=t,u.aggregatedResults=i,u};return Object(v.jsx)("div",{className:"App",children:Object(v.jsxs)("header",{className:"App-header",children:[Object(v.jsx)("h3",{children:"CA File"}),Object(v.jsx)(f,{onFileLoad:function(e){return function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n].data,o={id:r.id,caName:r.name,portfolio:r.portfolio,location:r.location,currentAllotment:0,cumulativePropensity:0,cumulativeInherent:0,averagePropensity:0,varianceToInherent:0,predictedConversions:0};t[n]=o}u(t)}(e)},onFileRemove:function(){return k()}}),Object(v.jsx)("h3",{children:"Lead File"}),Object(v.jsx)(f,{onFileLoad:function(e){return function(e){for(var t=[],n=function(n){for(var r=e[n].data,o={leadId:r.leadId,created:I()(r.created,"DD/MM/YYYY hh:mm"),inherent:r.inherent,portfolio:r.portfolio,courseAdvisors:[]},a=0,i=function(t){if(P.some((function(r){return r===e[n].meta.fields[t]})))return"continue";var i={id:a++,caName:e[n].meta.fields[t],propensity:r[e[n].meta.fields[t]]};o.courseAdvisors.push(i)},c=0;c<e[n].meta.fields.length;c++)i(c);t[n]=o},r=0;r<e.length;r++)n(r);o(t)}(e)},onFileRemove:function(){return k()},disabled:!(s&&s.length>0)}),Object(v.jsx)(y,{selectedMode:p,onModeChange:function(e){return function(e){F(),b(m[e])}(e)},onParameterChange:function(e,t){return function(e){var t=R?R.slice():[];e.target.value?t[e.target.name]=e.target.value:t.splice(e.target.name),F(t)}(e)}}),Object(v.jsx)("button",{onClick:function(){return function(){var e=L(p.allocationFunction(n,s,R));o(e.leads),u(e.courseAdvisors),A(e.aggregatedResults)}()},disabled:!n||!p||p.parameters&&(!R||Object.keys(R).length<Object.keys(p.parameters).length),children:"Run Simulation"}),Object(v.jsx)(H,{courseAdvisors:s,aggregatedResults:O})]})})},P=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,56)).then((function(t){var n=t.getCLS,r=t.getFID,o=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),r(e),o(e),a(e),i(e)}))};i.a.render(Object(v.jsx)(o.a.StrictMode,{children:Object(v.jsx)(F,{})}),document.getElementById("root")),P()}},[[55,1,2]]]);
//# sourceMappingURL=main.c60748e4.chunk.js.map