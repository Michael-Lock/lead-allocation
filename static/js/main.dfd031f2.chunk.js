(this["webpackJsonplead-allocation"]=this["webpackJsonplead-allocation"]||[]).push([[0],{35:function(e,t,r){},38:function(e,t){},40:function(e,t){},55:function(e,t,r){"use strict";r.r(t);var n=r(2),o=r.n(n),a=r(22),l=r.n(a),i=(r(35),r(1)),c=r(6),s=r(23),d=r(24),u=r(30),m=r(29),h=r(25),f=r(0),b=function(e){Object(u.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(s.a)(this,r),(n=t.call(this,e)).handleOpenDialog=function(e){n.state.buttonRef.current&&n.state.buttonRef.current.open(e)},n.handleOnFileLoad=function(e){return n.props.onFileLoad(e)},n.handleOnError=function(e,t,r,n){console.log(e)},n.handleOnRemoveFile=function(e){return n.props.onFileRemove()},n.handleRemoveFile=function(e){n.state.buttonRef.current&&n.state.buttonRef.current.removeFile(e)},n.state={buttonRef:o.a.createRef()},n}return Object(d.a)(r,[{key:"render",value:function(){var e=this;return Object(f.jsx)(h.a,{ref:this.state.buttonRef?this.state.buttonRef:null,onFileLoad:this.handleOnFileLoad,onError:this.handleOnError,noClick:!0,noDrag:!0,config:{header:!0,dynamicTyping:!0,skipEmptyLines:!0},onRemoveFile:this.handleOnRemoveFile,children:function(t){var r=t.file;return Object(f.jsxs)("aside",{style:{display:"flex",flexDirection:"row",marginBottom:10},children:[Object(f.jsx)("button",{type:"button",onClick:e.handleOpenDialog,disabled:e.props.disabled,style:{borderRadius:0,marginLeft:0,marginRight:0,width:"40%",paddingLeft:0,paddingRight:0},children:"Browse file"}),Object(f.jsx)("div",{style:{borderWidth:1,borderStyle:"solid",borderColor:"#ccc",height:45,lineHeight:2.5,marginTop:5,marginBottom:5,paddingLeft:13,paddingTop:3,width:"60%"},children:r&&r.name}),Object(f.jsx)("button",{style:{borderRadius:0,marginLeft:0,marginRight:0,paddingLeft:20,paddingRight:20},onClick:e.handleRemoveFile,children:"Remove"})]})}})}}]),r}(n.Component),p={RoundRobin:{id:0,name:"Round Robin",description:"Allocates leads one by one to each available CA",allocationFunction:function(e,t){for(var r=e.slice(),n=t.map((function(e){var t=Object(i.a)({},e);return t.lastAllocatedId=-1,t})),o=n.filter((function(e){return e.portfolio===v})),a=n.filter((function(e){return e.portfolio===y})),l=function(e){var t=r[e],l=void 0;t.portfolio===v?l=o.sort((function(e,t){return e.lastAllocatedId-t.lastAllocatedId})):t.portfolio===y&&(l=a.sort((function(e,t){return e.lastAllocatedId-t.lastAllocatedId})));var i=l.filter((function(e){return C(t.created,e.location)})),c=i.length>0?i[0]:l[0];c.lastAllocatedId=t.leadId,t.allocatedCa=c.id,n[c.id].totalAllotment++,n[c.id].currentAllotment++},c=0;c<e.length;c++)l(c);return{leads:r,courseAdvisors:n}}},RoundRobinUnconstrained:{id:1,name:"Round Robin (Unconstrained)",description:"Allocates leads one by one to each CA, irrespective of portfolio or working hours",allocationFunction:function(e,t){for(var r=e.slice(),n=t.map((function(e){var t=Object(i.a)({},e);return t.lastAllocatedId=-1,t})),o=0;o<e.length;o++){var a=r[o],l=n.slice().sort((function(e,t){return e.lastAllocatedId-t.lastAllocatedId}))[0];l.lastAllocatedId=a.leadId,a.allocatedCa=l.id,n[l.id].totalAllotment++,n[l.id].currentAllotment++}return{leads:r,courseAdvisors:n}}},MostSuitableUnconstrained:{id:2,name:"Most Suitable (Unconstrained)",description:"Allocates leads always to the CA with the highest likelihood of conversion. Ignores portfolio and working hours constraints",allocationFunction:function(e,t){for(var r=e.slice(),n=t.slice(),o=0;o<e.length;o++){for(var a=r[o],l=n.slice(),c=0;c<l.length;c++){var s=l[c];l[c]=Object(i.a)(Object(i.a)({},s),{},{propensity:a.courseAdvisors[s.id].propensity})}l.sort((function(e,t){return t.propensity-e.propensity}));var d=l[0];a.allocatedCa=d.id,n[d.id].totalAllotment++,n[d.id].currentAllotment++}return{leads:r,courseAdvisors:n}}},MostSuitableAggressive:{id:3,name:"Most Suitable (Aggressive)",description:"Allocates leads always to the CA with the highest likelihood of conversion. Uses lowest current allotment as a tiebreaker",allocationFunction:function(e,t){for(var r=e.slice(),n=t.slice(),o=function(e){for(var t=r[e],o=n.filter((function(e){return O(e,t)})),a=0;a<o.length;a++){var l=o[a],c=C(t.created,n[l.id].location);o[a]=Object(i.a)(Object(i.a)({},l),{},{propensity:t.courseAdvisors[l.id].propensity,isInWorkingHours:c})}o.sort((function(e,t){return t.isInWorkingHours&&!e.isInWorkingHours?1:e.isInWorkingHours&&!t.isInWorkingHours?-1:t.propensity!==e.propensity?t.propensity-e.propensity:e.totalAllotment-t.totalAllotment}));var s=o[0];t.allocatedCa=s.id,n[s.id].totalAllotment++,n[s.id].currentAllotment++},a=0;a<e.length;a++)o(a);return{leads:r,courseAdvisors:n}}},MostSuitableFixedAllotmentTolerance:{id:4,name:"Most Suitable (Fixed allotment tolerance)",description:"Allocates leads to the CA with the highest likelihood of conversion, so long as their allotment is not a given number of leads more than any other CA currently available. If all available CAs are outside of this tolerance, picks the one with the fewest leads currently allotted",parameters:{allotmentTolerance:{order:0,label:"Allotment Tolerance"},decayPerDay:{order:1,label:"Lead decay per day"},cycleDecayDurationDays:{order:2,label:"Days per sales cycle"},decayPerCycle:{order:3,label:"Lead decay per sales cycle (%)"}},allocationFunction:function(e,t,r){return A(e,t,r,!1)}},MostSuitableProportionalAllotmentTolerance:{id:5,name:"Most Suitable (Proportional allotment tolerance)",description:"Allocates leads to the CA with the highest likelihood of conversion, so long as their allotment is not a number of leads more than any other CA currently available by a given percentage. If all available CAs are outside of this tolerance, picks the one with the fewest leads currently allotted",parameters:{allotmentTolerance:{order:0,label:"Allotment Tolerance (%)"},decayPerDay:{order:1,label:"Lead decay per day"},cycleDecayDurationDays:{order:2,label:"Days per sales cycle"},decayPerCycle:{order:3,label:"Lead decay per sales cycle (%)"}},allocationFunction:function(e,t,r){return A(e,t,r,!0)}},SuitabilityAllotmentBalancedLinear:{id:6,name:"Suitability vs. Allotment Balance (Linear)",description:"Allocates leads to the CA based on both their suitability and their current allotment. Higher suitability will increase the preference given to the CA but a higher allotment will decrease it. Weightings are used to control the relative importance of choosing most suitable vs. balancing allotment",parameters:{suitabilityWeighting:{order:0,label:"Suitability weighting"},allotmentWeighting:{order:1,label:"Allotment weighting"},decayPerDay:{order:2,label:"Lead decay per day"},cycleDecayDurationDays:{order:3,label:"Days per sales cycle"},decayPerCycle:{order:4,label:"Lead decay per sales cycle (%)"}},allocationFunction:function(e,t,r){for(var n=e.slice(),o=t.slice(),a=Number(r[p.SuitabilityAllotmentBalancedLinear.parameters.suitabilityWeighting.order]),l=Number(r[p.SuitabilityAllotmentBalancedLinear.parameters.allotmentWeighting.order]),c=Number(r[p.SuitabilityAllotmentBalancedLinear.parameters.decayPerDay.order]),s=Number(r[p.SuitabilityAllotmentBalancedLinear.parameters.cycleDecayDurationDays.order]),d=Number(r[p.SuitabilityAllotmentBalancedLinear.parameters.decayPerCycle.order])/100,u=e[0].created.clone().startOf("date"),m=u.clone(),h=u.clone(),f=function(t){var r=n[t],u=0,f=0,b=e[t].created.clone().startOf("date"),p=b.diff(h,"days");if(s>0&&p>=s){for(var v=Math.floor(p/s),y=d^v,g=0;g<o.length;g++){var A=o[g];A.currentAllotment=A.currentAllotment*(1-y)}h.add(s,"days")}var j=b.diff(m,"days");if(j>0){for(var I=0;I<o.length;I++){var P=o[I],x=j*c*P.decayModifier;P.currentAllotment=Math.max(P.currentAllotment-x,0)}m=b.clone()}for(var H=o.filter((function(e){return O(e,r)})),F=0;F<H.length;F++){var R=H[F];u+=R.currentAllotment,f++;var M=C(r.created,o[R.id].location),S=r.courseAdvisors[R.id].propensity*a;H[F]=Object(i.a)(Object(i.a)({},R),{},{suitabilityScore:S,isInWorkingHours:M})}var k=void 0;k=f>0?u/f:u/H.length,H.sort((function(e,t){if(t.isInWorkingHours&&!e.isInWorkingHours)return 1;if(e.isInWorkingHours&&!t.isInWorkingHours)return-1;var r=e.suitabilityScore+(k-e.currentAllotment)*l,n=t.suitabilityScore+(k-t.currentAllotment)*l;return n!==r?n-r:e.currentAllotment-t.currentAllotment}));var D=H[0];r.allocatedCa=D.id,o[D.id].totalAllotment++,o[D.id].currentAllotment=D.currentAllotment+1},b=0;b<e.length;b++)f(b);return{leads:n,courseAdvisors:o}}},SuitabilityAllotmentBalancedProportional:{id:6,name:"Suitability vs. Allotment Balance (Proportional)",description:"Allocates leads to the CA based on both their suitability and their current allotment. Higher suitability proportionally relative to the average will increase the preference given to the CA but a higher allotment will decrease it. Weightings are used to control the relative importance of choosing most suitable vs. balancing allotment",parameters:{suitabilityWeighting:{order:0,label:"Suitability weighting"},allotmentWeighting:{order:1,label:"Allotment weighting"},decayPerDay:{order:2,label:"Lead decay per day"},cycleDecayDurationDays:{order:3,label:"Days per sales cycle"},decayPerCycle:{order:4,label:"Lead decay per sales cycle (%)"}},allocationFunction:function(e,t,r){for(var n=e.slice(),o=t.slice(),a=Number(r[p.SuitabilityAllotmentBalancedProportional.parameters.suitabilityWeighting.order]),l=Number(r[p.SuitabilityAllotmentBalancedProportional.parameters.allotmentWeighting.order]),c=Number(r[p.SuitabilityAllotmentBalancedProportional.parameters.decayPerDay.order]),s=Number(r[p.SuitabilityAllotmentBalancedProportional.parameters.cycleDecayDurationDays.order]),d=Number(r[p.SuitabilityAllotmentBalancedProportional.parameters.decayPerCycle.order])/100,u=e[0].created.clone().startOf("date"),m=u.clone(),h=u.clone(),f=function(t){var r=n[t],u=0,f=0,b=0,p=e[t].created.clone().startOf("date"),v=p.diff(h,"days");if(s>0&&v>=s){for(var y=Math.floor(v/s),g=d^y,A=0;A<o.length;A++){var I=o[A];I.currentAllotment=I.currentAllotment*(1-g)}h.add(s,"days")}var P=p.diff(m,"days");if(P>0){for(var x=0;x<o.length;x++){var H=o[x],F=P*c*H.decayModifier;H.currentAllotment=Math.max(H.currentAllotment-F,0)}m=p.clone()}for(var R=o.filter((function(e){return O(e,r)})),M=0;M<R.length;M++){var S=R[M];u+=S.currentAllotment,f+=r.courseAdvisors[S.id].propensity,b++;var k=C(r.created,o[S.id].location);R[M]=Object(i.a)(Object(i.a)({},S),{},{propensity:r.courseAdvisors[S.id].propensity,isInWorkingHours:k})}var D=void 0,L=void 0;b>0?(D=u/b,L=f/b):(D=u/R.length,L=f/R.length),R.sort((function(e,t){if(t.isInWorkingHours&&!e.isInWorkingHours)return 1;if(e.isInWorkingHours&&!t.isInWorkingHours)return-1;var r=j(e,L,D,a,l),n=j(t,L,D,a,l);return n!==r?n-r:e.currentAllotment-t.currentAllotment}));var W=R[0];r.allocatedCa=W.id,o[W.id].totalAllotment++,o[W.id].currentAllotment=W.currentAllotment+1},b=0;b<e.length;b++)f(b);return{leads:n,courseAdvisors:o}}}},v="Domestic",y="Canada",g={Adelaide:{startHour:9,endHour:17,timezoneOffsetFromAdelaide:0},Canada:{startHour:22.5,endHour:6.5,timezoneOffsetFromAdelaide:13.5}};function A(e,t,r,n){var o=e.slice(),a=t.slice(),l=Number(r[p.MostSuitableFixedAllotmentTolerance.parameters.allotmentTolerance.order]);n&&(l/=100);for(var c=Number(r[p.MostSuitableFixedAllotmentTolerance.parameters.decayPerDay.order]),s=Number(r[p.MostSuitableFixedAllotmentTolerance.parameters.cycleDecayDurationDays.order]),d=Number(r[p.MostSuitableFixedAllotmentTolerance.parameters.decayPerCycle.order])/100,u=e[0].created.clone().startOf("date"),m=u.clone(),h=u.clone(),f=function(t){var r=o[t],u=Number.MAX_SAFE_INTEGER,f=e[t].created.clone().startOf("date"),b=f.diff(h,"days");if(s>0&&b>=s){for(var p=Math.floor(b/s),v=d^p,y=0;y<a.length;y++){var g=a[y];g.currentAllotment=g.currentAllotment*(1-v)}h.add(s,"days")}var A=f.diff(m,"days");if(A>0){for(var j=0;j<a.length;j++){var I=a[j],P=A*c*I.decayModifier;I.currentAllotment=Math.max(I.currentAllotment-P,0)}m=f.clone()}for(var x=a.filter((function(e){return O(e,r)})),H=0;H<x.length;H++){var F=x[H];u=Math.min(F.currentAllotment,u);var R=C(r.created,a[F.id].location);x[H]=Object(i.a)(Object(i.a)({},F),{},{propensity:r.courseAdvisors[F.id].propensity,isInWorkingHours:R})}var M=void 0;M=n?u+u*l:u+l,x.sort((function(e,t){return t.isInWorkingHours&&!e.isInWorkingHours?1:e.isInWorkingHours&&!t.isInWorkingHours?-1:t.currentAllotment<M&&e.currentAllotment>=M?1:e.currentAllotment<M&&t.currentAllotment>=M?-1:e.currentAllotment>=M&&t.currentAllotment>=M&&t.currentAllotment!==e.currentAllotment?e.currentAllotment-t.currentAllotment:t.propensity!==e.propensity?t.propensity-e.propensity:e.currentAllotment-t.currentAllotment}));var S=x[0];r.allocatedCa=S.id,a[S.id].totalAllotment++,a[S.id].currentAllotment=S.currentAllotment+1},b=0;b<e.length;b++)f(b);return{leads:o,courseAdvisors:a}}function j(e,t,r,n,o){return(t>0?(e.propensity-t)/t*n:0)+(r-e.currentAllotment)*o}function O(e,t){return e.portfolio===t.portfolio}function C(e,t){var r=g[t],n=e.hour()+e.minute()/60,o=e.clone().subtract(r.timezoneOffsetFromAdelaide,"hours").day();if(0===o||6===o)return!1;var a=r.endHour,l=n;return r.endHour<=r.startHour&&(a=r.endHour+24,n<r.startHour&&(l+=24)),l>=r.startHour&&l<=a}var I=function(e){var t=[Object(f.jsx)("option",{value:null,hidden:!0},"unselected")];t=t.concat(Object.keys(p).map((function(e){return Object(f.jsx)("option",{value:e,children:p[e].name},p[e].name)})));var r=[];if(e.selectedMode&&e.selectedMode.parameters)for(var n=Object.keys(e.selectedMode.parameters),o=function(t){var o=e.selectedMode.parameters[n[t]];r[t]=Object(f.jsxs)("div",{children:[Object(f.jsx)("label",{htmlFor:n[t],children:o.label}),Object(f.jsx)("input",{name:n[t],type:"number",step:"any",onChange:function(t){return e.onParameterChange(t,o.order)}})]},n[t])},a=0;a<n.length;a++)o(a);return Object(f.jsxs)("div",{children:[Object(f.jsx)("select",{onChange:function(t){return e.onModeChange(t.target.value)},children:t}),Object(f.jsx)("div",{children:e.selectedMode?e.selectedMode.description:""}),r]})},P=r(27),x=r.n(P),H=r(28);function F(e){var t=e.columns,r=e.data,n=Object(H.useTable)({columns:t,data:r}),o=n.getTableProps,a=n.getTableBodyProps,l=n.headerGroups,c=n.rows,s=n.prepareRow;return Object(f.jsxs)("table",Object(i.a)(Object(i.a)({},o()),{},{children:[Object(f.jsx)("thead",{children:l.map((function(e){return Object(f.jsx)("tr",Object(i.a)(Object(i.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e){return Object(f.jsx)("th",Object(i.a)(Object(i.a)({},e.getHeaderProps()),{},{children:e.render("Header")}))}))}))}))}),Object(f.jsx)("tbody",Object(i.a)(Object(i.a)({},a()),{},{children:c.map((function(e,t){return s(e),Object(f.jsx)("tr",Object(i.a)(Object(i.a)({},e.getRowProps()),{},{children:e.cells.map((function(e){return Object(f.jsx)("td",Object(i.a)(Object(i.a)({},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}))]}))}var R=function(e){var t=o.a.useMemo((function(){return[{Header:"CA",accessor:"caName"},{Header:"Portfolio",accessor:"portfolio"},{Header:"Location",accessor:"location"},{Header:"Total Allotment",accessor:"totalAllotment"},{Header:"Final Allotment",accessor:"currentAllotment"},{Header:"Average Propensity",accessor:function(e){return e?e.averagePropensity.toFixed(3):0}},{Header:"Variance to Inherent",accessor:function(e){return e?e.varianceToInherent.toFixed(3):0}},{Header:"Predicted Conversions",accessor:function(e){return e?e.predictedConversions.toFixed(2):0}}]}),[]),r=o.a.useMemo((function(){return[{Header:"Total Leads",accessor:"totalLeads"},{Header:"Average Propensity",accessor:function(e){return e?e.averagePropensity.toFixed(3):0}},{Header:"Average Variance to Inherent",accessor:function(e){return e?e.averageVarianceToInherent.toFixed(3):0}},{Header:"Predicted Conversions",accessor:function(e){return e?e.predictedConversions.toFixed(2):0}}]}),[]);return Object(f.jsxs)("div",{children:[Object(f.jsx)("h3",{children:"Aggregated Results"}),Object(f.jsx)(F,{columns:r,data:e.aggregatedResults?[e.aggregatedResults]:[]}),Object(f.jsx)("h3",{children:"Individual CA Results"}),Object(f.jsx)(F,{columns:t,data:e.courseAdvisors?e.courseAdvisors:[]})]})};var M=function(){var e=Object(n.useState)(),t=Object(c.a)(e,2),r=t[0],o=t[1],a=Object(n.useState)(),l=Object(c.a)(a,2),s=l[0],d=l[1],u=Object(n.useState)(),m=Object(c.a)(u,2),h=m[0],v=m[1],y=Object(n.useState)(),g=Object(c.a)(y,2),A=g[0],j=g[1],O=Object(n.useState)(),C=Object(c.a)(O,2),P=C[0],H=C[1],F=["leadId","created","inherent","portfolio"],M=function(){o(),d(),j(),H()},S=function(e){for(var t=e.courseAdvisors.slice(),r=0;r<e.leads.length;r++){var n=e.leads[r],o=t[n.allocatedCa],a=n.courseAdvisors[o.id].propensity;o.cumulativePropensity=o.cumulativePropensity+a,o.cumulativeInherent=o.cumulativeInherent+n.inherent}for(var l={totalLeads:0,cumulativePropensity:0,cumulativeInherent:0,averagePropensity:0,averageVarianceToInherent:0,predictedConversions:0},c=0;c<t.length;c++){var s=t[c];s.averagePropensity=s.totalAllotment?s.cumulativePropensity/s.totalAllotment:0,s.varianceToInherent=s.cumulativePropensity-s.cumulativeInherent,s.predictedConversions=s.totalAllotment*s.averagePropensity,l.totalLeads+=s.totalAllotment,l.cumulativePropensity+=s.cumulativePropensity,l.cumulativeInherent+=s.cumulativeInherent,l.predictedConversions+=s.predictedConversions}l.averagePropensity=l.cumulativePropensity/l.totalLeads,l.averageVarianceToInherent=(l.cumulativePropensity-l.cumulativeInherent)/t.length;var d=Object(i.a)({},e);return d.courseAdvisors=t,d.aggregatedResults=l,d};return Object(f.jsx)("div",{className:"App",children:Object(f.jsxs)("header",{className:"App-header",children:[Object(f.jsx)("h3",{children:"CA File"}),Object(f.jsx)(b,{onFileLoad:function(e){return function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r].data,o={id:n.id,caName:n.name,portfolio:n.portfolio,location:n.location,decayModifier:n.decayModifier,totalAllotment:0,currentAllotment:0,cumulativePropensity:0,cumulativeInherent:0,averagePropensity:0,varianceToInherent:0,predictedConversions:0};t[r]=o}d(t)}(e)},onFileRemove:function(){return M()}}),Object(f.jsx)("h3",{children:"Lead File"}),Object(f.jsx)(b,{onFileLoad:function(e){return function(e){for(var t=[],r=function(r){for(var n=e[r].data,o={leadId:n.leadId,created:x()(n.created,"YYYY-MM-DDTHH:MMZ"),inherent:n.inherent,portfolio:n.portfolio,courseAdvisors:[]},a=0,l=function(t){if(F.some((function(n){return n===e[r].meta.fields[t]})))return"continue";var l={id:a++,caName:e[r].meta.fields[t],propensity:n[e[r].meta.fields[t]]};o.courseAdvisors.push(l)},i=0;i<e[r].meta.fields.length;i++)l(i);t[r]=o},n=0;n<e.length;n++)r(n);o(t)}(e)},onFileRemove:function(){return M()},disabled:!(s&&s.length>0)}),Object(f.jsx)(I,{selectedMode:h,onModeChange:function(e){return function(e){H(),v(p[e])}(e)},onParameterChange:function(e,t){return function(e,t){var r=P?P.slice():[];e.target.value?r[t]=e.target.value:r.splice(t),H(r)}(e,t)}}),Object(f.jsx)("button",{onClick:function(){return function(){var e=S(h.allocationFunction(r,s,P));o(e.leads),d(e.courseAdvisors),j(e.aggregatedResults)}()},disabled:!r||!h||h.parameters&&(!P||P.length<Object.keys(h.parameters).length),children:"Run Simulation"}),Object(f.jsx)(R,{courseAdvisors:s,aggregatedResults:A})]})})},S=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,56)).then((function(t){var r=t.getCLS,n=t.getFID,o=t.getFCP,a=t.getLCP,l=t.getTTFB;r(e),n(e),o(e),a(e),l(e)}))};l.a.render(Object(f.jsx)(o.a.StrictMode,{children:Object(f.jsx)(M,{})}),document.getElementById("root")),S()}},[[55,1,2]]]);
//# sourceMappingURL=main.dfd031f2.chunk.js.map