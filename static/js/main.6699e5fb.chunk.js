(this["webpackJsonplead-allocation"]=this["webpackJsonplead-allocation"]||[]).push([[0],{35:function(e,t,n){},38:function(e,t){},40:function(e,t){},55:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),a=n(22),i=n.n(a),c=(n(35),n(2)),s=n(7),l=n(23),d=n(24),u=n(30),v=n(29),f=n(25),h=n(0),p=function(e){Object(u.a)(n,e);var t=Object(v.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).handleOpenDialog=function(e){r.state.buttonRef.current&&r.state.buttonRef.current.open(e)},r.handleOnFileLoad=function(e){return r.props.onFileLoad(e)},r.handleOnError=function(e,t,n,r){console.log(e)},r.handleOnRemoveFile=function(e){return r.props.onFileRemove()},r.handleRemoveFile=function(e){r.state.buttonRef.current&&r.state.buttonRef.current.removeFile(e)},r.state={buttonRef:o.a.createRef()},r}return Object(d.a)(n,[{key:"render",value:function(){var e=this;return Object(h.jsx)(f.a,{ref:this.state.buttonRef?this.state.buttonRef:null,onFileLoad:this.handleOnFileLoad,onError:this.handleOnError,noClick:!0,noDrag:!0,config:{header:!0,dynamicTyping:!0,skipEmptyLines:!0},onRemoveFile:this.handleOnRemoveFile,children:function(t){var n=t.file;return Object(h.jsxs)("aside",{style:{display:"flex",flexDirection:"row",marginBottom:10},children:[Object(h.jsx)("button",{type:"button",onClick:e.handleOpenDialog,disabled:e.props.disabled,style:{borderRadius:0,marginLeft:0,marginRight:0,width:"40%",paddingLeft:0,paddingRight:0},children:"Browse file"}),Object(h.jsx)("div",{style:{borderWidth:1,borderStyle:"solid",borderColor:"#ccc",height:45,lineHeight:2.5,marginTop:5,marginBottom:5,paddingLeft:13,paddingTop:3,width:"60%"},children:n&&n.name}),Object(h.jsx)("button",{style:{borderRadius:0,marginLeft:0,marginRight:0,paddingLeft:20,paddingRight:20},onClick:e.handleRemoveFile,children:"Remove"})]})}})}}]),n}(r.Component),b="Domestic",j="Canada",m={Adelaide:{startHour:9,endHour:17},Canada:{startHour:22.5,endHour:6.5}},g=[{id:0,name:"Round Robin",description:"Allocates leads one by one to each available CA",allocationFunction:function(e,t){for(var n=e.slice(),r=t.map((function(e){var t=Object(c.a)({},e);return t.lastAllocatedId=-1,t})),o=r.filter((function(e){return e.portfolio===b})),a=r.filter((function(e){return e.portfolio===j})),i=function(e){var t=n[e],i=void 0;t.portfolio===b?i=o.sort((function(e,t){return e.lastAllocatedId-t.lastAllocatedId})):t.portfolio===j&&(i=a.sort((function(e,t){return e.lastAllocatedId-t.lastAllocatedId})));var c=i.filter((function(e){return A(t.created,e.location)})),s=c.length>0?c[0]:i[0];s.lastAllocatedId=t.leadId,t.allocatedCa=s.id,r[s.id].currentAllotment++},s=0;s<e.length;s++)i(s);return{leads:n,courseAdvisors:r}}},{id:1,name:"Most Suitable (Aggressive)",description:"Allocates leads always to the CA with the highest likelihood of conversion. Lowest current allotment is used only as a tiebreaker",allocationFunction:function(e,t){for(var n=e.slice(),r=t.slice(),o=0;o<e.length;o++){for(var a=n[o],i=-1,c=void 0,s=!1,l=0;l<r.length;l++){var d=r[l],u=a.courseAdvisors[l].propensity;if(O(d,a)){var v=A(a.created,d.location),f=!c||v&&!s;f||s&&!v||(f=u>i||u===i&&c.currentAllotment>d.currentAllotment),f&&(c=d,s=v,i=u)}}c||console.log("No allocation?"),a.allocatedCa=c.id,r[c.id].currentAllotment++}return{leads:n,courseAdvisors:r}}}];function O(e,t){return e.portfolio===t.portfolio}function A(e,t){var n=m[t],r=e.hour()+e.minute()/60,o=n.endHour,a=r;return n.endHour<=n.startHour&&(o=n.endHour+24,r<n.startHour&&(a+=24)),a>=n.startHour&&a<=o}var x=function(e){var t=[Object(h.jsx)("option",{value:null,hidden:!0},"unselected")];return t=t.concat(g.map((function(e){return Object(h.jsx)("option",{value:e.id,children:e.name},e.name)}))),Object(h.jsxs)("div",{children:[Object(h.jsx)("select",{onChange:function(t){return e.onModeChange(t.target.value)},children:t}),Object(h.jsx)("div",{children:e.selectedMode?e.selectedMode.description:""})]})},y=n(27),R=n.n(y),C=n(28);function F(e){var t=e.columns,n=e.data,r=Object(C.useTable)({columns:t,data:n}),o=r.getTableProps,a=r.getTableBodyProps,i=r.headerGroups,s=r.rows,l=r.prepareRow;return Object(h.jsxs)("table",Object(c.a)(Object(c.a)({},o()),{},{children:[Object(h.jsx)("thead",{children:i.map((function(e){return Object(h.jsx)("tr",Object(c.a)(Object(c.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e){return Object(h.jsx)("th",Object(c.a)(Object(c.a)({},e.getHeaderProps()),{},{children:e.render("Header")}))}))}))}))}),Object(h.jsx)("tbody",Object(c.a)(Object(c.a)({},a()),{},{children:s.map((function(e,t){return l(e),Object(h.jsx)("tr",Object(c.a)(Object(c.a)({},e.getRowProps()),{},{children:e.cells.map((function(e){return Object(h.jsx)("td",Object(c.a)(Object(c.a)({},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}))]}))}var P=function(e){var t=o.a.useMemo((function(){return[{Header:"CA",accessor:"caName"},{Header:"Portfolio",accessor:"portfolio"},{Header:"Location",accessor:"location"},{Header:"Allotment",accessor:"currentAllotment"},{Header:"Average Propensity",accessor:function(e){return e?e.averagePropensity.toFixed(2):0}},{Header:"Variance to Inherent",accessor:function(e){return e?e.varianceToInherent.toFixed(2):0}},{Header:"Predicted Conversions",accessor:function(e){return e?e.predictedConversions.toFixed(2):0}}]}),[]),n=o.a.useMemo((function(){return[{Header:"Total Leads",accessor:"totalLeads"},{Header:"Average Propensity",accessor:function(e){return e?e.averagePropensity.toFixed(2):0}},{Header:"Average Variance to Inherent",accessor:function(e){return e?e.averageVarianceToInherent.toFixed(2):0}},{Header:"Predicted Conversions",accessor:function(e){return e?e.predictedConversions.toFixed(2):0}}]}),[]);return Object(h.jsxs)("div",{children:[Object(h.jsx)(F,{columns:n,data:e.aggregatedResults?[e.aggregatedResults]:[]}),Object(h.jsx)(F,{columns:t,data:e.courseAdvisors?e.courseAdvisors:[]})]})};var I=function(){var e=Object(r.useState)(),t=Object(s.a)(e,2),n=t[0],o=t[1],a=Object(r.useState)(),i=Object(s.a)(a,2),l=i[0],d=i[1],u=Object(r.useState)(),v=Object(s.a)(u,2),f=v[0],b=v[1],j=Object(r.useState)(),m=Object(s.a)(j,2),O=m[0],A=m[1],y=["leadId","created","inherent","portfolio"],C=function(){o(),d(),A()},F=function(){var e=function(e){for(var t=e.courseAdvisors.slice(),n=0;n<e.leads.length;n++){var r=e.leads[n],o=t[r.allocatedCa],a=r.courseAdvisors[o.id].propensity;o.cumulativePropensity=o.cumulativePropensity+a,o.cumulativeInherent=o.cumulativeInherent+r.inherent}for(var i={totalLeads:0,cumulativePropensity:0,cumulativeInherent:0,averagePropensity:0,averageVarianceToInherent:0,predictedConversions:0},s=0;s<t.length;s++){var l=t[s];l.averagePropensity=l.currentAllotment?l.cumulativePropensity/l.currentAllotment:0,l.varianceToInherent=l.cumulativePropensity-l.cumulativeInherent,l.predictedConversions=l.currentAllotment*l.averagePropensity,i.totalLeads+=l.currentAllotment,i.cumulativePropensity+=l.cumulativePropensity,i.cumulativeInherent+=l.cumulativeInherent,i.predictedConversions+=l.predictedConversions}i.averagePropensity=i.cumulativePropensity/i.totalLeads,i.averageVarianceToInherent=(i.cumulativePropensity-i.cumulativeInherent)/t.length;var d=Object(c.a)({},e);return d.courseAdvisors=t,d.aggregatedResults=i,d}(f.allocationFunction(n,l));o(e.leads),d(e.courseAdvisors),A(e.aggregatedResults)};return Object(h.jsx)("div",{className:"App",children:Object(h.jsxs)("header",{className:"App-header",children:[Object(h.jsx)("p",{children:"CA File"}),Object(h.jsx)(p,{onFileLoad:function(e){return function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n].data,o={id:r.id,caName:r.name,portfolio:r.portfolio,location:r.location,currentAllotment:0,cumulativePropensity:0,cumulativeInherent:0,averagePropensity:0,varianceToInherent:0,predictedConversions:0};t[n]=o}d(t)}(e)},onFileRemove:function(){return C()}}),Object(h.jsx)("p",{children:"Lead File"}),Object(h.jsx)(p,{onFileLoad:function(e){return function(e){for(var t=[],n=function(n){for(var r=e[n].data,o={leadId:r.leadId,created:R()(r.created,"DD/MM/YYYY hh:mm"),inherent:r.inherent,portfolio:r.portfolio,courseAdvisors:[]},a=0,i=function(t){if(y.some((function(r){return r===e[n].meta.fields[t]})))return"continue";var i={id:a++,caName:e[n].meta.fields[t],propensity:r[e[n].meta.fields[t]]};o.courseAdvisors.push(i)},c=0;c<e[n].meta.fields.length;c++)i(c);t[n]=o},r=0;r<e.length;r++)n(r);o(t)}(e)},onFileRemove:function(){return C()},disabled:!(l&&l.length>0)}),Object(h.jsx)(x,{selectedMode:f,onModeChange:function(e){return function(e){b(g[e])}(e)}}),Object(h.jsx)("button",{onClick:function(){return F()},disabled:!n||!f,children:"Run Simulation"}),Object(h.jsx)(P,{courseAdvisors:l,aggregatedResults:O})]})})},H=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,56)).then((function(t){var n=t.getCLS,r=t.getFID,o=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),r(e),o(e),a(e),i(e)}))};i.a.render(Object(h.jsx)(o.a.StrictMode,{children:Object(h.jsx)(I,{})}),document.getElementById("root")),H()}},[[55,1,2]]]);
//# sourceMappingURL=main.6699e5fb.chunk.js.map