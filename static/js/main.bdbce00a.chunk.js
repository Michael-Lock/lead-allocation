(this["webpackJsonplead-allocation"]=this["webpackJsonplead-allocation"]||[]).push([[0],{35:function(e,t,n){},38:function(e,t){},40:function(e,t){},55:function(e,t,n){"use strict";n.r(t);var r=n(2),o=n.n(r),a=n(22),i=n.n(a),l=(n(35),n(1)),c=n(6),s=n(23),d=n(24),u=n(30),m=n(29),f=n(25),p=n(0),h=function(e){Object(u.a)(n,e);var t=Object(m.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).handleOpenDialog=function(e){r.state.buttonRef.current&&r.state.buttonRef.current.open(e)},r.handleOnFileLoad=function(e){return r.props.onFileLoad(e)},r.handleOnError=function(e,t,n,r){console.log(e)},r.handleOnRemoveFile=function(e){return r.props.onFileRemove()},r.handleRemoveFile=function(e){r.state.buttonRef.current&&r.state.buttonRef.current.removeFile(e)},r.state={buttonRef:o.a.createRef()},r}return Object(d.a)(n,[{key:"render",value:function(){var e=this;return Object(p.jsx)(f.a,{ref:this.state.buttonRef?this.state.buttonRef:null,onFileLoad:this.handleOnFileLoad,onError:this.handleOnError,noClick:!0,noDrag:!0,config:{header:!0,dynamicTyping:!0,skipEmptyLines:!0},onRemoveFile:this.handleOnRemoveFile,children:function(t){var n=t.file;return Object(p.jsxs)("aside",{style:{display:"flex",flexDirection:"row",marginBottom:10},children:[Object(p.jsx)("button",{type:"button",onClick:e.handleOpenDialog,disabled:e.props.disabled,style:{borderRadius:0,marginLeft:0,marginRight:0,width:"40%",paddingLeft:0,paddingRight:0},children:"Browse file"}),Object(p.jsx)("div",{style:{borderWidth:1,borderStyle:"solid",borderColor:"#ccc",height:45,lineHeight:2.5,marginTop:5,marginBottom:5,paddingLeft:13,paddingTop:3,width:"60%"},children:n&&n.name}),Object(p.jsx)("button",{style:{borderRadius:0,marginLeft:0,marginRight:0,paddingLeft:20,paddingRight:20},onClick:e.handleRemoveFile,children:"Remove"})]})}})}}]),n}(r.Component),v={RoundRobin:{id:0,name:"Round Robin",description:"Allocates leads one by one to each available CA",allocationFunction:function(e,t){for(var n=e.slice(),r=t.map((function(e){var t=Object(l.a)({},e);return t.lastAllocatedId=-1,t})),o=r.filter((function(e){return e.portfolio===b})),a=r.filter((function(e){return e.portfolio===g})),i=function(e){var t=n[e],i=void 0;t.portfolio===b?i=o.sort((function(e,t){return e.lastAllocatedId-t.lastAllocatedId})):t.portfolio===g&&(i=a.sort((function(e,t){return e.lastAllocatedId-t.lastAllocatedId})));var l=i.filter((function(e){return A(t.created,e.location)})),c=l.length>0?l[0]:i[0];c.lastAllocatedId=t.leadId,t.allocatedCa=c.id,r[c.id].currentAllotment++},c=0;c<e.length;c++)i(c);return{leads:n,courseAdvisors:r}}},MostSuitableAggressive:{id:1,name:"Most Suitable (Aggressive)",description:"Allocates leads always to the CA with the highest likelihood of conversion. Uses lowest current allotment as a tiebreaker",allocationFunction:function(e,t){for(var n=e.slice(),r=t.slice(),o=function(e){for(var t=n[e],o=r.filter((function(e){return y(e,t)})),a=0;a<o.length;a++){var i=o[a],c=A(t.created,r[i.id].location);o[a]=Object(l.a)(Object(l.a)({},i),{},{propensity:t.courseAdvisors[i.id].propensity,isInWorkingHours:c})}o.sort((function(e,t){return t.isInWorkingHours&&!e.isInWorkingHours?1:e.isInWorkingHours&&!t.isInWorkingHours?-1:t.propensity!==e.propensity?t.propensity-e.propensity:e.currentAllotment-t.currentAllotment}));var s=o[0];t.allocatedCa=s.id,r[s.id].currentAllotment++},a=0;a<e.length;a++)o(a);return{leads:n,courseAdvisors:r}}},MostSuitableFixedAllotmentTolerance:{id:2,name:"Most Suitable (Fixed allotment tolerance)",description:"Allocates leads to the CA with the highest likelihood of conversion, so long as their allotment is not a given number of leads more than any other CA currently available. If all available CAs are outside of this tolerance, picks the one with the fewest leads currently allotted",parameters:{allotmentTolerance:{order:0,label:"Allotment Tolerance"},decayPerDay:{order:1,label:"Lead decay per day"}},allocationFunction:function(e,t,n){for(var r=e.slice(),o=t.slice(),a=n[v.MostSuitableFixedAllotmentTolerance.parameters.allotmentTolerance.order],i=n[v.MostSuitableFixedAllotmentTolerance.parameters.decayPerDay.order],c=e[0].created.clone().startOf("date"),s=function(t){for(var n=r[t],s=Number.MAX_SAFE_INTEGER,d=e[t].created.clone().startOf("date").diff(c,"days"),u=o.filter((function(e){return y(e,n)})),m=0;m<u.length;m++){var f=u[m],p=Math.max(f.currentAllotment-d*i,0);s=p<s?p:s;var h=A(n.created,o[f.id].location);u[m]=Object(l.a)(Object(l.a)({},f),{},{propensity:n.courseAdvisors[f.id].propensity,decayedAllotment:p,isInWorkingHours:h})}u.sort((function(e,t){return t.isInWorkingHours&&!e.isInWorkingHours?1:e.isInWorkingHours&&!t.isInWorkingHours?-1:t.decayedAllotment-s<a&&e.decayedAllotment-s>=a?1:e.decayedAllotment-s<a&&t.decayedAllotment-s>=a?-1:e.decayedAllotment-s>=a&&t.decayedAllotment-s>=a&&t.decayedAllotment!==e.decayedAllotment?e.decayedAllotment-t.decayedAllotment:t.propensity!==e.propensity?t.propensity-e.propensity:e.decayedAllotment-t.decayedAllotment}));var v=u[0];n.allocatedCa=v.id,o[v.id].currentAllotment++},d=0;d<e.length;d++)s(d);return{leads:r,courseAdvisors:o}}},MostSuitableProportionalAllotmentTolerance:{id:3,name:"Most Suitable (Proportional allotment tolerance)",description:"Allocates leads to the CA with the highest likelihood of conversion, so long as their allotment is not a number of leads more than any other CA currently available by a given percentage. If all available CAs are outside of this tolerance, picks the one with the fewest leads currently allotted",parameters:{allotmentTolerance:{order:0,label:"Allotment Tolerance (%)"},decayPerDay:{order:1,label:"Lead decay per day"}},allocationFunction:function(e,t,n){for(var r=e.slice(),o=t.slice(),a=n[v.MostSuitableFixedAllotmentTolerance.parameters.allotmentTolerance.order]/100,i=n[v.MostSuitableFixedAllotmentTolerance.parameters.decayPerDay.order],c=e[0].created.clone().startOf("date"),s=function(t){for(var n=r[t],s=Number.MAX_SAFE_INTEGER,d=e[t].created.clone().startOf("date").diff(c,"days"),u=o.filter((function(e){return y(e,n)})),m=0;m<u.length;m++){var f=u[m],p=Math.max(f.currentAllotment-d*i,0);s=p<s?p:s;var h=A(n.created,o[f.id].location);u[m]=Object(l.a)(Object(l.a)({},f),{},{propensity:n.courseAdvisors[f.id].propensity,decayedAllotment:p,isInWorkingHours:h})}var v=s+s*a;u.sort((function(e,t){return t.isInWorkingHours&&!e.isInWorkingHours?1:e.isInWorkingHours&&!t.isInWorkingHours?-1:t.decayedAllotment<v&&e.decayedAllotment>=v?1:e.decayedAllotment<v&&t.decayedAllotment>=v?-1:e.decayedAllotment>=v&&t.decayedAllotment>=v&&t.decayedAllotment!==e.decayedAllotment?e.decayedAllotment-t.decayedAllotment:t.propensity!==e.propensity?t.propensity-e.propensity:e.decayedAllotment-t.decayedAllotment}));var b=u[0];n.allocatedCa=b.id,o[b.id].currentAllotment++},d=0;d<e.length;d++)s(d);return{leads:r,courseAdvisors:o}}}},b="Domestic",g="Canada",j={Adelaide:{startHour:9,endHour:17,timezoneOffsetFromAdelaide:0},Canada:{startHour:22.5,endHour:6.5,timezoneOffsetFromAdelaide:13.5}};function y(e,t){return e.portfolio===t.portfolio}function A(e,t){var n=j[t],r=e.hour()+e.minute()/60,o=e.clone().subtract(n.timezoneOffsetFromAdelaide,"hours").day();if(0===o||6===o)return!1;var a=n.endHour,i=r;return n.endHour<=n.startHour&&(a=n.endHour+24,r<n.startHour&&(i+=24)),i>=n.startHour&&i<=a}var O=function(e){var t=[Object(p.jsx)("option",{value:null,hidden:!0},"unselected")];t=t.concat(Object.keys(v).map((function(e){return Object(p.jsx)("option",{value:e,children:v[e].name},v[e].name)})));var n=[];if(e.selectedMode&&e.selectedMode.parameters)for(var r=Object.keys(e.selectedMode.parameters),o=function(t){var o=e.selectedMode.parameters[r[t]];n[t]=Object(p.jsxs)("div",{children:[Object(p.jsx)("label",{htmlFor:r[t],children:o.label}),Object(p.jsx)("input",{name:r[t],type:"number",step:"any",onChange:function(t){return e.onParameterChange(t,o.order)}})]},r[t])},a=0;a<r.length;a++)o(a);return Object(p.jsxs)("div",{children:[Object(p.jsx)("select",{onChange:function(t){return e.onModeChange(t.target.value)},children:t}),Object(p.jsx)("div",{children:e.selectedMode?e.selectedMode.description:""}),n]})},x=n(27),I=n.n(x),C=n(28);function F(e){var t=e.columns,n=e.data,r=Object(C.useTable)({columns:t,data:n}),o=r.getTableProps,a=r.getTableBodyProps,i=r.headerGroups,c=r.rows,s=r.prepareRow;return Object(p.jsxs)("table",Object(l.a)(Object(l.a)({},o()),{},{children:[Object(p.jsx)("thead",{children:i.map((function(e){return Object(p.jsx)("tr",Object(l.a)(Object(l.a)({},e.getHeaderGroupProps()),{},{children:e.headers.map((function(e){return Object(p.jsx)("th",Object(l.a)(Object(l.a)({},e.getHeaderProps()),{},{children:e.render("Header")}))}))}))}))}),Object(p.jsx)("tbody",Object(l.a)(Object(l.a)({},a()),{},{children:c.map((function(e,t){return s(e),Object(p.jsx)("tr",Object(l.a)(Object(l.a)({},e.getRowProps()),{},{children:e.cells.map((function(e){return Object(p.jsx)("td",Object(l.a)(Object(l.a)({},e.getCellProps()),{},{children:e.render("Cell")}))}))}))}))}))]}))}var H=function(e){var t=o.a.useMemo((function(){return[{Header:"CA",accessor:"caName"},{Header:"Portfolio",accessor:"portfolio"},{Header:"Location",accessor:"location"},{Header:"Allotment",accessor:"currentAllotment"},{Header:"Average Propensity",accessor:function(e){return e?e.averagePropensity.toFixed(2):0}},{Header:"Variance to Inherent",accessor:function(e){return e?e.varianceToInherent.toFixed(2):0}},{Header:"Predicted Conversions",accessor:function(e){return e?e.predictedConversions.toFixed(2):0}}]}),[]),n=o.a.useMemo((function(){return[{Header:"Total Leads",accessor:"totalLeads"},{Header:"Average Propensity",accessor:function(e){return e?e.averagePropensity.toFixed(2):0}},{Header:"Average Variance to Inherent",accessor:function(e){return e?e.averageVarianceToInherent.toFixed(2):0}},{Header:"Predicted Conversions",accessor:function(e){return e?e.predictedConversions.toFixed(2):0}}]}),[]);return Object(p.jsxs)("div",{children:[Object(p.jsx)("h3",{children:"Aggregated Results"}),Object(p.jsx)(F,{columns:n,data:e.aggregatedResults?[e.aggregatedResults]:[]}),Object(p.jsx)("h3",{children:"Individual CA Results"}),Object(p.jsx)(F,{columns:t,data:e.courseAdvisors?e.courseAdvisors:[]})]})};var R=function(){var e=Object(r.useState)(),t=Object(c.a)(e,2),n=t[0],o=t[1],a=Object(r.useState)(),i=Object(c.a)(a,2),s=i[0],d=i[1],u=Object(r.useState)(),m=Object(c.a)(u,2),f=m[0],b=m[1],g=Object(r.useState)(),j=Object(c.a)(g,2),y=j[0],A=j[1],x=Object(r.useState)(),C=Object(c.a)(x,2),F=C[0],R=C[1],P=["leadId","created","inherent","portfolio"],k=function(){o(),d(),A(),R()},M=function(e){for(var t=e.courseAdvisors.slice(),n=0;n<e.leads.length;n++){var r=e.leads[n],o=t[r.allocatedCa],a=r.courseAdvisors[o.id].propensity;o.cumulativePropensity=o.cumulativePropensity+a,o.cumulativeInherent=o.cumulativeInherent+r.inherent}for(var i={totalLeads:0,cumulativePropensity:0,cumulativeInherent:0,averagePropensity:0,averageVarianceToInherent:0,predictedConversions:0},c=0;c<t.length;c++){var s=t[c];s.averagePropensity=s.currentAllotment?s.cumulativePropensity/s.currentAllotment:0,s.varianceToInherent=s.cumulativePropensity-s.cumulativeInherent,s.predictedConversions=s.currentAllotment*s.averagePropensity,i.totalLeads+=s.currentAllotment,i.cumulativePropensity+=s.cumulativePropensity,i.cumulativeInherent+=s.cumulativeInherent,i.predictedConversions+=s.predictedConversions}i.averagePropensity=i.cumulativePropensity/i.totalLeads,i.averageVarianceToInherent=(i.cumulativePropensity-i.cumulativeInherent)/t.length;var d=Object(l.a)({},e);return d.courseAdvisors=t,d.aggregatedResults=i,d};return Object(p.jsx)("div",{className:"App",children:Object(p.jsxs)("header",{className:"App-header",children:[Object(p.jsx)("h3",{children:"CA File"}),Object(p.jsx)(h,{onFileLoad:function(e){return function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n].data,o={id:r.id,caName:r.name,portfolio:r.portfolio,location:r.location,currentAllotment:0,cumulativePropensity:0,cumulativeInherent:0,averagePropensity:0,varianceToInherent:0,predictedConversions:0};t[n]=o}d(t)}(e)},onFileRemove:function(){return k()}}),Object(p.jsx)("h3",{children:"Lead File"}),Object(p.jsx)(h,{onFileLoad:function(e){return function(e){for(var t=[],n=function(n){for(var r=e[n].data,o={leadId:r.leadId,created:I()(r.created,"YYYY-MM-DDTHH:MMZ"),inherent:r.inherent,portfolio:r.portfolio,courseAdvisors:[]},a=0,i=function(t){if(P.some((function(r){return r===e[n].meta.fields[t]})))return"continue";var i={id:a++,caName:e[n].meta.fields[t],propensity:r[e[n].meta.fields[t]]};o.courseAdvisors.push(i)},l=0;l<e[n].meta.fields.length;l++)i(l);t[n]=o},r=0;r<e.length;r++)n(r);o(t)}(e)},onFileRemove:function(){return k()},disabled:!(s&&s.length>0)}),Object(p.jsx)(O,{selectedMode:f,onModeChange:function(e){return function(e){R(),b(v[e])}(e)},onParameterChange:function(e,t){return function(e,t){var n=F?F.slice():[];e.target.value?n[t]=e.target.value:n.splice(t),R(n)}(e,t)}}),Object(p.jsx)("button",{onClick:function(){return function(){var e=M(f.allocationFunction(n,s,F));o(e.leads),d(e.courseAdvisors),A(e.aggregatedResults)}()},disabled:!n||!f||f.parameters&&(!F||F.length<Object.keys(f.parameters).length),children:"Run Simulation"}),Object(p.jsx)(H,{courseAdvisors:s,aggregatedResults:y})]})})},P=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,56)).then((function(t){var n=t.getCLS,r=t.getFID,o=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),r(e),o(e),a(e),i(e)}))};i.a.render(Object(p.jsx)(o.a.StrictMode,{children:Object(p.jsx)(R,{})}),document.getElementById("root")),P()}},[[55,1,2]]]);
//# sourceMappingURL=main.bdbce00a.chunk.js.map